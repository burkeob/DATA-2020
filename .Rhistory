beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals[diff_beta]<0]["direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
#extract significant coef
sig_coefs <- function(model) {
coefs <- as.data.frame(summary(model)[13][[1]])
coefs <- coefs %>% subset(coefs[4]<0.05)
return(coefs)}
model_wealth_1987 <- svyglm(wealth_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 1987))
surv.des <- svydesign(data = df,
ids = ~vpsu,
weights = ~wgt_comb,
strata = ~vstrat,
nest=TRUE)
setwd("~/2022-2023/Spring/DATA2020/Project/DATA-2020")
load(file='cleaned_data.Rdata')
names <- c(2:3, 6:13)
df[,names] <- lapply(df[,names] , factor)
nums <- c(14,16)
df[,nums] <- lapply(df[,nums] , as.numeric)
df = subset(df, select = -c(wtssall,wtssnrps) )
df <- within(df, relig <- relevel(relig, ref = 'None'))
df <- within(df, marital <- relevel(marital, ref ='Never married'))
df <- within(df, partyid <- relevel(partyid, ref ='Independent'))
df <- within(df, wrkstat <- relevel(wrkstat, ref ='Working full time'))
df <- within(df, income <- relevel(income, ref ='$25,000 or more'))
df <- within(df, sex <- relevel(sex, ref ='MALE'))
df <- within(df, born <- relevel(born, ref ='YES'))
df <- within(df, race <- relevel(race, ref ='White'))
levels(df$wrkstat)[levels(df$wrkstat)=='With a job, but not at work because of temporary illness, vacation, strike'] <- 'FMLA,vacation,strike'
surv.des <- svydesign(data = df,
ids = ~vpsu,
weights = ~wgt_comb,
strata = ~vstrat,
nest=TRUE)
model_wealth_1987 <- svyglm(wealth_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 1987))
model_wealth_2021 <- svyglm(wealth_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 2021))
base_wealth_1987 <- svyglm(wealth_imp ~ 1, design=surv.des, family='quasibinomial', subset=(year == 1987))
base_wealth_2021 <- svyglm(wealth_imp ~ 1, design=surv.des, family='quasibinomial', subset=(year == 2021))
compare_coefs(model_wealth_1987,model_wealth_2021)
model1 <- model_wealth_1987
model2 <- model_wealth_2021
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals['difference']<0]["direction"] <- "Decrease from 1987"
pvals[difference<0]["direction"] <- "Decrease from 1987"
pvals[pvals$difference<0]["direction"] <- "Decrease from 1987"
pvals[,1]["direction"] <- "Decrease from 1987"
View(pvals)
View(pvals)
pvals$difference
pvals[pvals$difference,"direction"] <- "Decrease from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
#compare coefs
compare_coefs <- function(model1,model2){
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
#compare coefs
compare_coefs <- function(model1,model2){
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals['Variable'] <- row.names(pvals)
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=Difference, y=Variable, color=direction)) + ggcol()
p <-  ggplot(temp, aes(x=Difference, y=Variable, color=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Year") + scale_color_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change')
p
View(temp)
View(temp)
p <-  ggplot(temp, aes(x=difference, y=Variable, color=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Year") + scale_color_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change')
p
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change')
p
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals),position = position_dodge2(0.9),vjust=-0.5)
p
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals),position = position_dodge2(0.4),vjust=-0.5)
p
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals),position = position_dodge2(0.4))
#compare coefs
compare_coefs <- function(model1,model2){
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- as.data.frame(round(pvals,4))
diff_beta <- beta1-beta2
pvals['Variable'] <- row.names(pvals)
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals),position = position_dodge2(0.4))
p
View(temp)
View(temp)
#compare coefs
compare_coefs <- function(model1,model2){
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- signif(pvals,4)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals['Variable'] <- row.names(pvals)
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals),position = position_dodge2(0.4))
p
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals))
p
#compare coefs
compare_coefs <- function(model1,model2){
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- signif(pvals,3)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals['Variable'] <- row.names(pvals)
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals))
p
options(scipen=2)
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals))
p
options(scipen=1)
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals))
p
#compare coefs
compare_coefs <- function(model1,model2){
coefs1 <- as.data.frame(summary(model1)[13][[1]])
coefs2 <- as.data.frame(summary(model2)[13][[1]])
# coefs1 <- sig_coefs(model1)
# coefs2 <- sig_coefs(model2)
rows = intersect(row.names(coefs2),row.names(coefs1))
coefs1 <- coefs1 %>% filter(row.names(coefs1) %in% rows)
coefs2 <- coefs2 %>% filter(row.names(coefs2) %in% rows)
beta1 <- coefs1[[1]]
beta2 <- coefs2[[1]]
se1 <- coefs1[[2]]^2
se2 <- coefs2[[2]]^2
z <- abs(beta1-beta2)/sqrt(se1+se2)
pvals <- setNames(pnorm(-z),rows)
# pvals <- as.data.frame(pvals)
# pvals['Estimate 1987'] <- beta1
# pvals['p-value 1987'] <- coefs1[[4]]
# pvals['SE 1987'] <- coefs1[[2]]
# pvals['Estimate 2021'] <- beta2
# pvals['p-value 2021'] <- coefs2[[4]]
# pvals['SE 2021'] <- coefs2[[2]]
#
# return(pvals %>% subset(pvals<0.05))
#for plotting
# pvals1 <- as.data.frame(pvals)
# pvals2 <- as.data.frame(pvals)
# pvals1['Estimate'] <- beta1
# pvals1['SE'] <- coefs1[[2]]
# pvals1['Year'] <- 1987
# pvals1['Variable'] <- row.names(pvals1)
# pvals2['Estimate'] <- beta2
# pvals2['SE'] <-coefs2[[2]]
# pvals2['Year'] <- 2021
# pvals2['Variable'] <- row.names(pvals2)
# return(rbind(pvals1,pvals2) %>% subset(pvals<0.05)
pvals <- signif(pvals,2)
pvals <- as.data.frame(pvals)
diff_beta <- beta1-beta2
pvals['Variable'] <- row.names(pvals)
pvals["difference"] <- diff_beta
pvals['direction'] <-"Increase from 1987"
pvals[pvals$difference<0,"direction"] <- "Decrease from 1987"
pvals["difference"] <- abs(diff_beta)
return(pvals %>% subset(pvals<0.05))
}
temp <- as.data.frame(coefs_wealth <- compare_coefs(model_wealth_1987,model_wealth_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Wealth: Coefficient Change') + geom_text(aes(label=pvals))
p
ggsave("wealth_coefs.png")
temp <- as.data.frame(coefs_race <- compare_coefs(model_race_1987,model_race_2021))
model_race_1987 <- svyglm(race_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 1987))
model_race_2021 <- svyglm(race_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 2021))
base_race_1987 <- svyglm(race_imp ~ 1, design=surv.des, family='quasibinomial', subset=(year == 1987))
base_race_2021 <- svyglm(race_imp ~ 1, design=surv.des, family='quasibinomial', subset=(year == 2021))
compare_coefs(model_race_1987,model_race_2021)
temp <- as.data.frame(coefs_race <- compare_coefs(model_race_1987,model_race_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Race: Coefficient Change') + geom_text(aes(label=pvals))
p
ggsave("race_coefs.png")
model_relig_1987 <- svyglm(religion_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 1987))
model_relig_2021 <- svyglm(religion_imp ~ wrkstat+marital+age+educ+sex+race+born+income+
region+partyid+relig, design=surv.des, family='quasibinomial', subset=(year == 2021))
compare_coefs(model_relig_1987,model_relig_2021)
temp <- as.data.frame(coefs_relig <- compare_coefs(model_relig_1987,model_relig_2021))
temp <- temp %>%
mutate(direction = factor(direction))
p <-  ggplot(temp, aes(x=difference, y=Variable, fill=direction)) + geom_col() +
labs(x="Estimate", y="Variable", color="Direction of Change") + scale_fill_manual(values=c('#84a98c','#9f86c0')) +
ggtitle('Importance of Religion: Coefficient Change') + geom_text(aes(label=pvals))
p
ggsave("religion_coefs.png")
df_relig <- df %>% subset(select=c(religion_imp,wrkstat,marital,age,educ,sex,race,born,income,region,partyid,relig,year)) %>% drop_na()
df_wealth <- df %>% subset(select=c(wealth_imp,wrkstat,marital,age,educ,sex,race,born,income,region,partyid,relig,year))  %>% drop_na()
df_politics <- df %>% subset(select=c(political_imp,wrkstat,marital,age,educ,sex,race,born,income,region,partyid,relig,year))  %>% drop_na()
df_race <- df %>% subset(select=c(race_imp,wrkstat,marital,age,educ,sex,race,born,income,region,partyid,relig,year))  %>% drop_na()
df_sex <- df %>% subset(select=c(sex_imp,wrkstat,marital,age,educ,sex,race,born,income,region,partyid,relig,year)) %>% drop_na()
#accuracy calculations and visualizations
acc <- function(model,x,y){
pred <- predict(model, x, type='response')
pred[pred<=0.5] <- 0
pred[pred>0.5] <- 1
accuracy = mean(abs(pred - y))
return(accuracy)
}
summary(model_race_1987)$deviance - summary(base_race_1987)$deviance
summary(model_race_2021)$deviance - summary(base_race_2021)$deviance
acc(model_race_1987,subset(df_race,year==1987),subset(df_race,year==1987)$race_imp)
acc(model_race_2021,subset(df_race,year==2021),subset(df_race,year==2021)$race_imp)
summary(model_wealth_2021)$deviance - summary(base_wealth_2021)$deviance
acc(model_wealth_1987,subset(df_wealth,year==1987),subset(df_wealth,year==1987)$wealth_imp)
acc(model_wealth_2021,subset(df_wealth,year==2021),subset(df_wealth,year==2021)$wealth_imp)
summary(model_wealth_1987)$deviance - summary(base_wealth_1987)$deviance
summary(model_relig_1987)$deviance - summary(base_relig_1987)$deviance
base_relig_1987 <- svyglm(religion_imp ~ 1, design=surv.des, family='quasibinomial', subset=(year == 1987))
base_relig_2021 <- svyglm(religion_imp ~ 1, design=surv.des, family='quasibinomial', subset=(year == 2021))
summary(model_relig_1987)$deviance - summary(base_relig_1987)$deviance
summary(model_relig_2021)$deviance - summary(base_relig_2021)$deviance
acc(model_relig_1987,subset(df_relig,year==1987),subset(df_relig,year==1987)$religion_imp)
acc(model_relig_2021,subset(df_relig,year==2021),subset(df_relig,year==2021)$religion_imp)
